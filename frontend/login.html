<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login | CanIEdit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="/assets/images/favicon-48.png" sizes="48x48" type="image/png">
  <link rel="icon" href="/assets/images/favicon-96.png" sizes="96x96" type="image/png">
  <link rel="icon" href="/assets/images/favicon.ico">
  <link rel="stylesheet" href="/assets/css/output.css" />
</head>
<body class="flex min-h-screen flex-col bg-slate-50 text-slate-900">
  <div id="header"></div>

  <main class="flex-1">
    <section class="bg-gradient-to-br from-blue-50 via-white to-slate-50">
      <div class="mx-auto grid max-w-5xl gap-10 px-4 py-16 lg:grid-cols-[1.15fr,0.85fr] lg:items-center sm:py-20">
        <div class="text-center lg:text-left">
          <p class="inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-blue-700">Account access</p>
          <h1 class="mt-4 text-3xl font-bold leading-tight text-slate-900 sm:text-4xl">Sign in to CanIEdit</h1>
          <p class="mt-3 text-base text-slate-600">Use email or OAuth to pick up where you left off. We use magic links and one-time codes—no passwords to remember.</p>
          <div class="mt-6 flex flex-col items-center gap-3 text-sm text-slate-500 lg:items-start">
            <p>The secure sign-in dialog will open automatically. If it doesn’t, use the button below.</p>
            <button id="login-open" class="inline-flex items-center rounded-xl bg-blue-600 px-5 py-3 font-semibold text-white shadow-sm transition hover:bg-blue-700" type="button">Open sign-in</button>
          </div>
          <div class="mt-8 grid gap-4 text-left sm:grid-cols-2">
            <div class="rounded-2xl border border-blue-100 bg-white/70 p-4 shadow-sm">
              <p class="text-sm font-semibold text-slate-900">Faster workflows</p>
              <p class="mt-1 text-xs text-slate-500">Saved history, one-click re-runs, and synced tool preferences.</p>
            </div>
            <div class="rounded-2xl border border-blue-100 bg-white/70 p-4 shadow-sm">
              <p class="text-sm font-semibold text-slate-900">Double your limits</p>
              <p class="mt-1 text-xs text-slate-500">Authenticated sessions unlock higher daily processing limits.</p>
            </div>
          </div>
        </div>
        <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-[0_30px_100px_-60px_rgba(15,23,42,0.35)]">
          <div class="space-y-4">
            <div>
              <p class="text-xs font-semibold uppercase tracking-[0.18em] text-blue-600">Secure sign-in</p>
              <h2 class="mt-2 text-xl font-semibold text-slate-900">Keep your edits safe</h2>
              <p class="mt-2 text-sm text-slate-600">We authenticate via Supabase and trusted OAuth providers. Your files stay private and encrypted.</p>
            </div>
            <ul class="space-y-3 text-sm text-slate-600">
              <li class="flex items-start gap-3">
                <span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full bg-blue-50 text-blue-600">✓</span>
                Email one-time codes with 10-minute expiry.
              </li>
              <li class="flex items-start gap-3">
                <span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full bg-blue-50 text-blue-600">✓</span>
                OAuth options: Google
              </li>
              <li class="flex items-start gap-3">
                <span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full bg-blue-50 text-blue-600">✓</span>
                Session stored securely in your browser.
              </li>
            </ul>
            <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4 text-xs text-slate-500">
              <p>Need help? Email <a class="font-semibold text-blue-600 hover:text-blue-700" href="mailto:support@caniedit.com">support@caniedit.com</a>.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="footer"></div>

  <script src="./assets/include.js"></script>
  <script>
    async function getCurrentUser() {
      if (!window.CanIEditAuth || typeof window.CanIEditAuth.getUser !== "function") {
        return null;
      }
      return await window.CanIEditAuth.getUser();
    }

    function openAuthModal(message) {
      if (window.authModal && typeof window.authModal.open === "function") {
        window.authModal.open(message);
        return true;
      }
      return false;
    }

    async function initLoginPage() {
      const existingUser = await getCurrentUser();
      if (existingUser) {
        window.location.replace("/dashboard.html");
        return;
      }

      const promptMessage = "Sign in to access your dashboard.";
      let modalAttempts = 0;
      const ensureModal = () => {
        if (openAuthModal(promptMessage) || modalAttempts >= 40) {
          return;
        }
        modalAttempts += 1;
        setTimeout(ensureModal, 150);
      };

      ensureModal();

      const button = document.getElementById("login-open");
      button?.addEventListener("click", () => openAuthModal(promptMessage));

      document.addEventListener("auth:signed-in", () => {
        window.location.href = "/dashboard.html";
      });
    }

    window.addEventListener("DOMContentLoaded", initLoginPage);
  </script>
</body>
</html>
